<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CredAi | Apply for Credit Evaluation</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="stylesheet" href="css/style.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>

<body>

    <!-- GLASSMORPHISM NAVBAR -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">CredAi</a>

            <ul class="nav-menu">
                <li class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle">Our Technology</a>
                    <div class="dropdown-menu">
                        <a href="methodology.html" class="dropdown-item">Credit Evaluation</a>
                        <a href="risk-assessment.html" class="dropdown-item">Risk Assessment</a>
                        <a href="automation.html" class="dropdown-item">Automation</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle">Use Cases</a>
                    <div class="dropdown-menu">
                        <a href="use-case-smb.html" class="dropdown-item">SMB Lending</a>
                        <a href="use-case-consumer.html" class="dropdown-item">Consumer Lending</a>
                        <a href="use-case-auto.html" class="dropdown-item">Auto Loans</a>
                    </div>
                </li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="resources.html" class="nav-link">Resources</a></li>
            </ul>

            
            <div class="nav-actions">
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Theme">
                    <ion-icon name="sunny-outline" id="theme-icon"></ion-icon>
                </button>
                <a href="login.html" class="btn btn-outline"
                    style="margin-right: 12px; border: none; color: var(--color-white);">Sign In</a>
                <a href="signup.html" class="btn btn-primary">Start for Free</a>
            </div>
        </div>
    </nav>

    <div class="container" style="padding-top: 140px; padding-bottom: 80px;">
        <div class="stepper-container">
            <div class="text-center" style="margin-bottom: 60px;">
                <p class="label-tag">Application</p>
                <h2 style="margin-top: 16px;">Business Loan Application</h2>
            </div>

            <!-- Stepper Header -->
            <div class="stepper-header">
                <div class="step-item active" id="step-header-1">
                    <div class="step-circle">1</div>
                    <div class="step-label active">Business Basics</div>
                </div>
                <div class="step-item" id="step-header-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Financials</div>
                </div>
                <div class="step-item" id="step-header-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Documents</div>
                </div>
            </div>

            <form id="application-form">
                <!-- STEP 1: BUSINESS BASICS -->
                <div class="step-content active" id="step-1">
                    <div class="form-group">
                        <label class="form-label">Business Name</label>
                        <input type="text" id="businessName" class="form-input" name="business_name" required
                            placeholder="e.g. Acme Corp">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Industry Type</label>
                        <select id="industry" class="form-select" name="industry_type" required>
                            <option value="">Select industry...</option>
                            <option value="Retail">Retail</option>
                            <option value="Services">Services</option>
                            <option value="Manufacturing">Manufacturing</option>
                            <option value="Tech">Technology</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Years in Operation</label>
                        <input type="number" id="yearsInBusiness" class="form-input" name="years_in_operation" required
                            min="0">
                        <div class="strength-meter">
                            <div class="strength-fill" id="years-strength"></div>
                        </div>
                    </div>

                    <div class="form-actions" style="justify-content: flex-end;">
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next: Financials</button>
                    </div>
                </div>

                <!-- STEP 2: FINANCIALS -->
                <div class="step-content" id="step-2">
                    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Annual Revenue ($)</label>
                            <input type="number" id="revenue" class="form-input" name="annual_revenue" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Requested Loan Amount ($)</label>
                            <input type="number" id="loanAmount" class="form-input" name="loan_amount" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Monthly Operating Expenses ($)</label>
                        <input type="number" class="form-input" name="operating_expenses" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="nextStep(1)">Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next: Documents</button>
                    </div>
                </div>

                <!-- STEP 3: DOCUMENTS -->
                <div class="step-content" id="step-3">
                    <div class="file-upload-zone" id="drop-zone">
                        <div class="upload-icon">
                            <ion-icon name="cloud-upload-outline"></ion-icon>
                        </div>
                        <h3>Upload Bank Statements</h3>
                        <p style="color: var(--color-text-secondary);">Drag & drop PDF files here, or click to browse
                        </p>
                        <input type="file" id="fileInput" hidden multiple accept=".pdf">
                    </div>

                    <div id="file-list" style="margin-top: 20px;"></div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="nextStep(2)">Back</button>
                        <button type="submit" class="btn btn-primary">Submit Application</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Enhanced Stepper Logic with Validation
        function validateStep(stepNumber) {
            const step = document.getElementById('step-' + stepNumber);
            const inputs = step.querySelectorAll('input[required], select[required]');
            let isValid = true;
            let errorMessages = [];

            inputs.forEach(input => {
                // Remove previous error styling
                input.style.borderColor = '';

                if (!input.value || input.value.trim() === '') {
                    isValid = false;
                    input.style.borderColor = '#EF4444';
                    const label = step.querySelector(`label[for="${input.id}"]`) ||
                        input.previousElementSibling;
                    const fieldName = label ? label.textContent : 'This field';
                    errorMessages.push(`${fieldName} is required`);
                }
            });

            if (!isValid) {
                // Show error message
                alert('Please fill in all required fields:\n\n' + errorMessages.join('\n'));
            }

            return isValid;
        }

        function nextStep(step) {
            // Get current step
            const currentStep = document.querySelector('.step-content.active');
            const currentStepNumber = parseInt(currentStep.id.replace('step-', ''));

            // Validate current step before moving forward
            if (step > currentStepNumber && !validateStep(currentStepNumber)) {
                return; // Don't proceed if validation fails
            }

            // Save current step data to sessionStorage
            saveStepData(currentStepNumber);

            // Navigate to next step
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.step-item').forEach(el => {
                el.classList.remove('active');
                el.classList.remove('completed');
            });

            document.getElementById('step-' + step).classList.add('active');

            for (let i = 1; i <= step; i++) {
                const header = document.getElementById('step-header-' + i);
                if (i === step) {
                    header.classList.add('active');
                } else if (i < step) {
                    header.classList.add('completed');
                }
            }

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Save step data to sessionStorage
        function saveStepData(stepNumber) {
            const step = document.getElementById('step-' + stepNumber);
            const inputs = step.querySelectorAll('input, select');
            const data = {};

            inputs.forEach(input => {
                if (input.name) {
                    data[input.name] = input.value;
                }
            });

            sessionStorage.setItem('applicationStep' + stepNumber, JSON.stringify(data));
        }

        // Restore step data from sessionStorage
        function restoreStepData() {
            for (let i = 1; i <= 3; i++) {
                const savedData = sessionStorage.getItem('applicationStep' + i);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    const step = document.getElementById('step-' + i);

                    Object.keys(data).forEach(name => {
                        const input = step.querySelector(`[name="${name}"]`);
                        if (input && data[name]) {
                            input.value = data[name];
                        }
                    });
                }
            }
        }

        // Restore data on page load
        document.addEventListener('DOMContentLoaded', () => {
            restoreStepData();
        });

        // Strength Meter
        document.querySelector('input[name="years_in_operation"]').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            const bar = document.getElementById('years-strength');
            if (val > 5) {
                bar.style.width = '100%';
                bar.style.backgroundColor = '#10B981';
            } else if (val > 2) {
                bar.style.width = '60%';
                bar.style.backgroundColor = '#F59E0B';
            } else {
                bar.style.width = '30%';
                bar.style.backgroundColor = '#EF4444';
            }
        });

        // Document Upload Functionality
        const uploadBox = document.getElementById('drop-zone'); // Changed from 'upload-box' to 'drop-zone' to match HTML
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('file-list');
        window.uploadedFiles = []; // Make it globally accessible for validation

        // Click to browse
        uploadBox.addEventListener('click', () => {
            fileInput.click();
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Drag and drop
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = 'var(--color-primary)';
            uploadBox.style.background = 'rgba(147, 51, 234, 0.1)';
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.style.borderColor = 'var(--color-border)';
            uploadBox.style.background = 'transparent';
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = 'var(--color-border)';
            uploadBox.style.background = 'transparent';
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type === 'application/pdf') {
                    window.uploadedFiles.push(file);
                    displayFile(file);
                } else {
                    alert('Only PDF files are accepted');
                }
            });
        }

        function displayFile(file) {
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: var(--radius-md); margin-bottom: 8px;';

            fileItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <ion-icon name="document-text-outline" style="font-size: 24px; color: var(--color-primary);"></ion-icon>
                    <div>
                        <p style="margin: 0; font-weight: 500;">${file.name}</p>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--color-text-secondary);">${(file.size / 1024).toFixed(2)} KB</p>
                    </div>
                </div>
                <button type="button" onclick="removeFile('${file.name}')" style="background: none; border: none; cursor: pointer; color: var(--color-danger);">
                    <ion-icon name="close-circle-outline" style="font-size: 24px;"></ion-icon>
                </button>
            `;

            fileList.appendChild(fileItem);
        }

        window.removeFile = function (filename) {
            window.uploadedFiles = window.uploadedFiles.filter(f => f.name !== filename);
            // Refresh display
            fileList.innerHTML = '';
            window.uploadedFiles.forEach(file => displayFile(file));
        };
    </script>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <h2>CredAi</h2>
                    <p>The next generation of credit evaluation, powered by artificial intelligence and machine
                        learning.</p>
                </div>

                <div class="footer-col">
                    <h4>Company</h4>
                    <ul class="footer-links">
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Technology</h4>
                    <ul class="footer-links">
                        <li><a href="methodology.html">How It Works</a></li>
                        <li><a href="use-cases.html">Use Cases</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul class="footer-links">
                        <li><a href="resources.html">Articles</a></li>
                        <li><a href="ai-underwriting.html">AI Underwriting</a></li>
                        <li><a href="credit-analysis.html">Credit Analysis</a></li>
                        <li><a href="credit-risk-modeling.html">Credit Risk Modeling</a></li>
                        <li><a href="credit-underwriting.html">Credit Underwriting</a></li>
                        <li><a href="lending-underwriting.html">Lending Underwriting</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 CredAi. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/application-submit.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/animations.js"></script>
</body>

</html>


